<!DOCTYPE html>
<html>
<head>
    <title>Reveal.js 簡報編輯器</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.63.3/lib/codemirror.min.css">
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.63.3/lib/codemirror.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/codemirror@5.63.3/mode/xml/xml.min.js"></script>
    <style>
        .editor-container {
            display: flex;
            height: 500px;
        }
        .CodeMirror {
            flex: 1;
            height: 100%;
        }
        .snippets {
            width: 200px;
            padding: 10px;
            background-color: #f5f5f5;
            overflow-y: auto;
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
        }
    </style>
</head>
<body>
    <h1>Reveal.js 簡報編輯器</h1>
    <form method="post">
        <div class="editor-container">
            <textarea id="editor" name="content"><section></section></textarea>
            <div class="snippets">
                <h3>HTML 片段範例</h3>
                <ul>
                    <li>
                        <input type="checkbox" id="snippet1">
                        <label for="snippet1">加入標題</label>
                        <pre>&lt;h2&gt;簡報標題&lt;/h2&gt;</pre>
                    </li>
                    <li>
                        <input type="checkbox" id="snippet2">
                        <label for="snippet2">新增圖片</label>
                        <pre>&lt;img src="圖片網址" alt="圖片說明"&gt;</pre>
                    </li>
                    <li>
                        <input type="checkbox" id="snippet3">
                        <label for="snippet3">嵌入 YouTube 影片</label>
                        <pre>&lt;iframe src="https://www.youtube.com/embed/影片ID" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;</pre>
                    </li>
                </ul>
            </div>
        </div>
        <br>
        <button type="submit">預覽簡報</button>
    </form>

    <script>
        var editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
            mode: 'xml',
            lineNumbers: true
        });

        // 監聽複選框變化,並將選取的片段插入編輯器
        var checkboxes = document.querySelectorAll('.snippets input[type="checkbox"]');
        for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].addEventListener('change', function() {
                if (this.checked) {
                    var snippet = this.nextElementSibling.nextElementSibling.textContent;
                    var cursorPos = editor.getCursor();
                    var lineContent = editor.getLine(cursorPos.line);
                    var openingTagIndex = lineContent.indexOf('<section>') + 9;
                    var closingTagIndex = lineContent.indexOf('</section>');
                    var insertionPoint = {
                        line: cursorPos.line,
                        ch: closingTagIndex
                    };

                    // 清空 <section> 與 </section> 之間的內容
                    editor.replaceRange('', {
                        line: cursorPos.line,
                        ch: openingTagIndex
                    }, insertionPoint);

                    if (this.id === 'snippet1') { // 加入標題
                        editor.replaceRange(snippet, insertionPoint);
                    } else { // 其他片段
                        editor.replaceRange(snippet, insertionPoint);
                        insertionPoint.ch += snippet.length;
                    }
                }
            });
        }
    </script>
</body>
</html>
